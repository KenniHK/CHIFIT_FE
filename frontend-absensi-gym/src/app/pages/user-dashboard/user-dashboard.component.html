<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3" style="margin-top: 2.5em;">
    <!-- <img src="assets/CHIFIT-LOGIN.png" alt="CHIFIT" class="logo" width="15em" /> -->
    <h5 class="sectionBadge" style="font-style: italic;">Halo, {{ name }}</h5>
    <button class="btn btn-outline-danger" (click)="LogOut()">Log Out</button>
  </div>

  <app-tips-carousel></app-tips-carousel>

  <br>
  <!-- Form Absensi -->
  <div class="card mb-4" id="editAbsensi">
    <div class="card-header" style="background-color: rgba(74, 74, 207, 0.796); color: white;">
      Form Absensi
    </div>
    <div class="card-body">
      <form>
        <div class="mb-3">
          <label for="trainingType" class="form-label">Jenis Latihan</label>
          <select class="form-select" [(ngModel)]="selectedTrainingType" id="trainingType" name="trainingType" required (change)="onTrainingTypeChange()">
            <option *ngFor="let type of trainingTypes" [value]="type.training_id">{{ type.training_name }}</option>
          </select>

          <div *ngIf="selectedTrainingExercise.length > 0" class="mt-3">
            <div class="row">
              <div class="col-md-6" *ngFor="let ex of selectedTrainingExercise; let i = index">
                <div class="card mb-2 shadow-sm">
                  <div class="card-body py-2">
                    <div class="d-flex align-items-center justify-content-between">
                      <small class="text-muted">{{ ex.name }}</small>
                      <input type="checkbox"
                            [(ngModel)]="ex.checked"
                            name="exerciseCheckbox_{{ i }}">
                    </div>
                    <div *ngIf="ex.checked" class="mt-2">
                      <input type="number"
                            [(ngModel)]="ex.duration_minutes"
                            name="duration_{{ i }}"
                            class="form-control"
                            placeholder="Durasi (menit)"
                            min="1">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
      </div>

        <div class="mb-3">
          <label for="notes" class="form-label">Catatan</label>
          <textarea class="form-control" [(ngModel)]="notes" id="notes" name="notes" rows="3" placeholder="Tambahkan catatan jika ada..."></textarea>
        </div>

        <button type="button" class="btn btn-primary" (click)="submitAttendance()">
          {{ attendanceId ? 'Update Absensi' : 'Kirim Absensi' }}
        </button>

        <div *ngIf="message" class="alert alert-success mt-3">{{ message }}</div>
        <div *ngIf="error" class="alert alert-danger mt-3">{{ error }}</div>
      </form>
    </div>
  </div>

 <!-- Grafik Kalori -->
<div class="grafik-section">
  <h6 class="sectionBadge mb-3">Grafik Kalori Terbakar</h6>

  <!-- Line Chart Card -->
  <div class="grafik-card">
    <div class="grafik-header">Kalori per Tanggal</div>
    <div class="grafik-body">
      <canvas #lineChart></canvas>
    </div>
  </div>

  <!-- Donut Chart Card -->
  <div class="grafik-card">
    <div class="grafik-header">Kalori per Jenis Latihan</div>
    <div class="grafik-body">
      <canvas #donutChart></canvas>
    </div>
  </div>
</div>


<hr>

<div>
  <h6 class="sectionBadge">Riwayat Absensi</h6>
  <div *ngIf="attendances.length === 0" class="text-muted">Belum ada absensi</div>

  <div *ngFor="let a of attendances" class="attendance-card">
  <div class="card">
    <!-- HEADER -->
    <div class="card-header cardAbsenHeader">
      <h6 class="training-title">{{ a.training_type }}</h6>
      <span class="status-badge" 
        [ngClass]="{
          'status-pending': a.status === 'pending',
          'status-approved': a.status === 'approved',
          'status-rejected': a.status === 'rejected'
        }">
        {{ a.status }}
      </span>
    </div>

    <!-- DETAIL -->
    <div class="card-content">
      <p><strong>Tanggal:</strong> {{ a.date | date:'medium' }}</p>
      <p><strong>Catatan:</strong> {{ a.notes }}</p>

      <h6>Latihan:</h6>
      <ul class="exercise-list">
        <li *ngFor="let ex of a.exercises">
          {{ ex.name }} <span style=" color: rgb(1, 123, 231);"> {{ ex.duration_minutes }} menit</span>
        </li>
      </ul>
    </div>

    <!-- HIGHLIGHT -->
    <div class="card-highlight">
      <p style="margin: auto 0;">ðŸ”¥ <strong>{{ a.total_calories_burned }}</strong> kcal terbakar</p>
    </div>

    <!-- FOOTER -->
    <div class="card-footer">
      <div *ngIf="a.admin_response" class="admin-comment">
        <strong>Komentar Admin:</strong>
        <p>{{ a.admin_response }}</p>
      </div>
      <button type="button" class="btn-edit" (click)="editAttendance(a)">
        Edit
      </button>
    </div>
  </div>
</div>

</div>
</div>
